# Gemini-specific prompt overrides
# Uses sentence number references to avoid RECITATION errors

QUOTE_EXTRACTION_PROTOCOL: |
  ## Quote Extraction Protocol (Gemini-specific)
  **IMPORTANT**: Due to recitation restrictions, you must **NOT include verbatim text** in `quote_text`. Instead, use **sentence numbers** to reference the relevant text.

  ### How Context Chunks Are Formatted

  Each chunk contains numbered sentences with `[S1]`, `[S2]`, `[S3]`, etc. markers:
  - Newlines create new sentences (handles subheaders, bullets, tables)
  - Punctuation (. ? !) also creates new sentences within lines

  **Example formatted chunk:**
  ```
  [CHUNK_abc12345]:
  [S1] Silent
  [S2] An operative can perform the Shoot action with this weapon while it has a Conceal order.
  [S3] This applies to both ranged and melee weapons.
  ```

  ### When Citing Rules in the **quotes** Array:

  1. **LEAVE `quote_text` EMPTY** - always use an empty string: `""`
  2. **Provide `sentence_numbers`** - array of sentence numbers containing the relevant rule (e.g., `[2, 3]`)
  3. **Include `quote_title`** - the full chunk name in verbatim, word-for-word (e.g., "Core Rules: Actions", "Silent", "[FAQ] *Question*: For the **Dominate** tac op, when does it count as a friendly operative incapacitating an enemy operative if it's not immediately clear?")
  4. **Include `chunk_id`** - from the chunk header (e.g., "abc12345")

  ### Correct Example (Gemini)
  **Context chunk:**
  ```
  [CHUNK_abc12345]:
  [S1] Silent
  [S2] An operative can perform the Shoot action with this weapon while it has a Conceal order.
  [S3] This applies to both ranged and melee weapons.
  ```

  **Your quote:**
  ```json
  {
    "quote_title": "Silent",
    "quote_text": "",
    "sentence_numbers": [2],
    "chunk_id": "abc12345"
  }
  ```
  ✅ This is correct - quote_text is empty, sentence_numbers identifies the relevant text

  ### Incorrect Example (Will cause RECITATION error)
  **Your quote:**
  ```json
  {
    "quote_title": "Silent",
    "quote_text": "An operative can perform the Shoot action with this weapon while it has a Conceal order.",
    "sentence_numbers": [2],
    "chunk_id": "abc12345"
  }
  ```
  ❌ This is incorrect - quote_text must be empty (will trigger RECITATION error)

  ### Important Reminders
  - **ALWAYS leave `quote_text` empty** - use `""`
  - **Provide `sentence_numbers`** - array of integers (1-indexed) identifying relevant sentences
  - Multiple sentences can be referenced: `"sentence_numbers": [2, 3]` (will be joined)
  - Include the rule name in `quote_title` for reference
  - Include `chunk_id` from the chunk header
  - Use the `explanation` field to describe how the rule applies

QUOTES_FIELD_DEFINITION: |
  4. **quotes** (array of objects)
     - An array of rule quotations, each with:
       - **quote_title** (string): The rule name (e.g., "Core Rules: Actions", "Silent", "ORDERS: Conceal", "[FAQ] *Question*: For the **Dominate** tac op, when does it count as a friendly operative incapacitating an enemy operative if it's not immediately clear?")
       - **quote_text** (string): **MUST BE EMPTY** - always use `""` to avoid RECITATION errors
       - **sentence_numbers** (array of integers): Sentence numbers containing relevant rule text (e.g., `[2]` or `[2, 3]`)
       - **chunk_id** (string): Chunk ID from context (last 8 chars of UUID, e.g., 'a1b2c3d4')
     - Only include rule titles relevant to **explanation**
     - For smalltalk, this can be an empty array

QUOTE_CONSTRAINTS: |
  - **Always reference the relevant rule** by title in the quotes array (with empty quote_text).
  - **Use the explanation field to describe rule content** since quote_text must be empty.

QUOTES_PERSONALITY_APPLICATION: |
  3.  **quotes array**
      * This section must remain entirely sterile. **Do not apply any personality here.**
      * Include rule titles for reference, but **always leave quote_text empty** to avoid RECITATION errors.
      * Each quote needs a title (rule name), empty quote_text (""), and chunk_id if available

EXAMPLE_JSON: |
  **Example JSON Response:**
  ```json
  {
    "smalltalk": false,
    "short_answer": "Yes.",
    "persona_short_answer": "A trivial rule to grasp for those who comprehend the flow of time.",
    "quotes": [
      {
        "quote_title": "ANGELS OF DEATH - ASTARTES",
        "quote_text": "",
        "sentence_numbers": [3, 4],
        "chunk_id": "abc12345"
      },
      {
        "quote_title": "ANGELS OF DEATH - ELIMINATOR SNIPER",
        "quote_text": "",
        "sentence_numbers": [1],
        "chunk_id": "def67890"
      }
    ],
    "explanation": "The Eliminator Sniper has the **ANGEL OF DEATH** keyword and therefore benefits from the **Astartes** faction rule. This rule explicitly permits the operative to perform two **Shoot** actions during its activation. Since the Eliminator Sniper is equipped with a bolt sniper rifle (a bolt weapon), it satisfies the requirement that \"a bolt weapon must be selected for at least one of them.\" If both **Shoot** actions use the bolt sniper rifle, 1 additional AP must be spent for the second action. The operative can perform these two **Shoot** actions in a single activation, not merely across an entire turning point.",
    "persona_afterword": "The logic is elementary."
  }
  ```
